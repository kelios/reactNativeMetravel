// data/pakocim/pakocimQuest.ts
import type { QuestStep, QuestFinale } from '@/components/quests/QuestWizard';
import {tryImage} from "@/components/quests/data/krakow/krakowDragon";

// нормализация для ответов (русский/польский ввод)
const normalize = (s: string) =>
    s.toLowerCase()
        .replace(/[.,;:!?'„”"–—-]/g, ' ')
        .replace(/\s+/g, ' ')
        .replace('ё', 'е')
        .replace(/[ąćęłńóśźż]/g, ch => ({ą:'a',ć:'c',ę:'e',ł:'l',ń:'n',ó:'o',ś:'s',ź:'z',ż:'z'} as any)[ch] ?? ch)
        .trim();

const gmaps = (lat:number,lng:number) => `https://maps.google.com/?q=${lat},${lng}`;
const IMG1 = tryImage(() => require('@/assets/quests/pakocim/1.png'));
const VIDEO = (() => { try { return require('@/assets/quests/pakocim/prokocim.mp4'); } catch { return null; } })();
// ─── ВСТУПЛЕНИЕ ───────────────────────────────────────────────────────────────
export const PAKOCIM_INTRO: QuestStep = {
    id: 'intro',
    title: 'Голоса Прокоцина',
    location: 'Начало пути',
    story:
        `Ты держишь в руках невидимую книгу Прокоцина.  
Каждая её страница — это место: герб, дворец, пруд, дерево, маленький сосед, старые укрепления и тропинка в будущее.  
Мы будем идти и слушать их голоса.  
Вопросы простые, но ответить на них можно только здесь — увидев и почувствовав.`,
    task: 'Нажми «Начать квест» и отправляйся в прогулку.',
    hint: undefined,
    answer: () => true,
    lat: 0, lng: 0, mapsUrl: '', image: null,
};

// ─── ОСНОВНЫЕ ТОЧКИ ───────────────────────────────────────────────────────────
export const PAKOCIM_STEPS: QuestStep[] = [
    {
        id: '1-herb',
        title: 'У ворот',
        location: 'Костёл св. Николая из Толентино',
        story:
            `Сегодня здесь стоит костёл святого Николая из Толентино. 
Но раньше на этом месте находилась усадьба рода Ержмановских. 
Их память хранит каменный герб Dołęga.  

По преданию, его история уходит в XIV век. В битве один из рыцарей пустил стрелу так метко, что она пробила подкову врага. 
Это сочли чудом и знаком небесной поддержки. 
С тех пор подкова стала символом защиты и удачи, а знак, проходящий сквозь неё, — напоминанием о воинской доблести.  

Посмотри внимательно на герб у костёла — в центре ты увидишь этот древний символ.`,
        task: 'Что проходит сквозь подкову на гербе Ержмановских?',
        hint: 'Это оружие, лёгкое и быстрое, но смертельно точное.',
        answer: s => ['стрела','strzala','arrow'].includes(normalize(s)),
        lat: 50.018536, lng: 19.994134,
        mapsUrl: gmaps(50.018536, 19.994134),
        image: IMG1,
    },
    {
        id: '2-palace',
        title: 'Сердце усадьбы',
        location: 'Дворец',
        story:
            `Перед тобой дворец, переживший смену эпох.  
Когда-то здесь принимали князя Юзефа Понятовского, позже Эразм Ержмановский превратил его в современную резиденцию с оранжереями и редкими растениями.  
Но первым хозяином был человек, чьё имя сохранилось на табличке.`,
        task: 'Назови имя первого владельца дворца.',
        hint: 'Его звали Michał …',
        answer: s => normalize(s) === 'michal wodzicki',
        lat: 50.019348, lng: 19.995399,
        mapsUrl: gmaps(50.019348, 19.995399),
        image: IMG1,
    },
    {
        id: '3-pond',
        title: 'Живая вода',
        location: 'Пруд',
        story:
            `В XIX веке усадебные пруды были местом прогулок и встреч.  
Сегодня здесь по-прежнему плавают птицы, словно напоминая: жизнь продолжается, несмотря на смену хозяев.  
Оглянись вокруг и посчитай пернатых на воде.`,
        task: 'Сколько уток ты видишь в пруду?',
        hint: 'Ответ меняется в зависимости от дня.',
        answer: s => !Number.isNaN(parseInt(s,10)),
        lat: 50.020948, lng: 20.004057,
        mapsUrl: gmaps(50.020948, 20.004057),
        image: IMG1,
    },
    {
        id: '4-oak',
        title: 'Страж времени',
        location: 'Старое дерево',
        story:
            `В аллее возвышается исполин. Его ствол испещрён глубокими трещинами, а крона раскинулась, как зелёный шатёр.  
Этот великан пережил больше, чем любой человек в округе, и хранит память парка.`,
        task: 'Какое дерево стоит здесь?',
        hint: 'Символ силы и долголетия в славянских традициях.',
        answer: s => normalize(s) === 'дуб',
        lat: 50.017682, lng: 20.012507,
        mapsUrl: gmaps(50.017682, 20.012507),
        image: IMG1,
    },
    {
        id: '5-hedgehog',
        title: 'Маленький сосед',
        location: 'Зона «Jeż na swoim»',
        story:
            `Парк заботится не только о деревьях, но и о самых маленьких.  
Здесь установлены укрытия и таблички для ночного жителя, который умеет сворачиваться в клубок и не боится больших соседей.`,
        task: 'Кто обитает в этом месте?',
        hint: 'Колючий герой народных сказок.',
        answer: s => ['еж','ёж','jez'].includes(normalize(s)),
        lat: 50.013842, lng: 20.01445,
        mapsUrl: gmaps(50.013842, 20.01445),
        image: IMG1,
    },
    {
        id: '6-birdhouses',
        title: 'Хор парка',
        location: 'Скворечники и качели',
        story:
            `В этом уголке парка соединяются два голоса — человеческий и птичий.  
Сядь на качели и дай себе несколько мгновений, чтобы почувствовать, как воздух играет в листьях.  
Пока ты раскачиваешься, подними взгляд на деревья вокруг: здесь жители района развесили домики для птиц.  
Весной и летом каждый из них наполняется новыми голосами — хор парка становится особенно громким.`,
        task: 'Сколько скворечников видно с качелей?',
        hint: 'Считай отдельные домики для птиц, даже если они прячутся в листве.',
        answer: s => { const n = parseInt(s,10); return !Number.isNaN(n) && n>=0 && n<=20; },
        lat: 50.013073, lng: 20.014758,
        mapsUrl: gmaps(50.013073, 20.014758),
        image: IMG1,
    },
    {
        id: '7-slona-woda',
        title: 'Солёная вода',
        location: 'Заказник',
        story:
            `Место с необычным названием — «Słona Woda».  
Легенда говорит, что вода здесь когда-то имела солёный привкус.  
Сегодня это охраняемая территория, и на табличке указана её точная площадь.`,
        task: 'Какова площадь заказника в гектарах?',
        hint: 'Число можно найти на информационном щите.',
        answer: s => Math.abs(parseFloat(s.replace(',','.')) - 13.53) < 0.01,
        lat: 50.005839, lng: 20.000021,
        mapsUrl: gmaps(50.005839, 20.000021),
        image: IMG1,
    },
    {
        id: '8-fort',
        title: 'Каменные стены',
        location: 'Форт Прокоцим',
        story:
            `В XIX веке Краков окружили австрийские укрепления.  
Этот форт — один из них.  
Его стены до сих пор носят следы: номера, символы, иногда даже надписи, оставленные солдатами.`,
        task: 'Найди знак или надпись на стене и опиши её одним словом.',
        hint: 'Смотри в камне, на табличках или железных элементах.',
        answer: s => typeof s === 'string' && s.trim().length>0,
        lat: 50.010556, lng: 19.997223,
        mapsUrl: gmaps(50.010556, 19.997223),
        image: IMG1,
    },
    {
        id: '9-bridge',
        title: 'Переход',
        location: 'Мост через ручей',
        story:
            `Маленький переход через поток соединяет две тропы.  
Он сделан из простого материала, знакомого каждому.  
Пройдя по нему, ты словно переходишь из прошлого Прокоцина в его будущее.`,
        task: 'Из какого материала сделан настил моста?',
        hint: 'Посмотри под ноги.',
        answer: s => ['дерево','деревянный','drewniany'].includes(normalize(s)),
        lat: 50.015474, lng: 19.991301,
        mapsUrl: gmaps(50.015474, 19.991301),
        image: IMG1,
    },
    {
        id: 'bonus-cafe',
        title: 'Сладкая пауза',
        location: 'Кавярня у парка',
        story:
            `Иногда история проявляется не только в камне или деревьях, а и в простых радостях.  
Не каждое место можно найти на карте, а это знают в основном местные.
По субботам и воскресеньям хозяйка открывает двери маленькой кавярни.
Главный хит — Наполеон, а к нему можно взять горячий облепиховый чай.  
Кавярня открыта только по выходным, поэтому заглянуть сюда — особая удача.  
Это место соединяет уют сегодняшнего дня и тепло гостеприимства.`,
        task: 'Никаких загадок — просто сделай паузу и насладись моментом.',
        hint: undefined,
        answer: () => true,
        lat: 50.018982, lng: 19.994333,
        mapsUrl: gmaps(50.018982, 19.994333),
        image: IMG1,
    },
];


// ─── ФИНАЛ ─────────────────────────────────────────────────────────────────────
export const PAKOCIM_FINALE: QuestFinale = {
    text:
        `Ты собрал все голоса Прокоцима в единую симфонию! 
От древнего герба со стрелой, пронзившей время, до каменных стен форта, хранящего шепот солдат...
От векового дуба-исполина до маленького ежа, что сворачивается в клубок под защитой парка...
Ты услышал как прошлое переплетается с настоящим в каждом уголке этого удивительного места.

Но самое главное — теперь ты стал частью этой истории. 
Твои шаги по мосту через ручей — это не просто переход, а символический жест: 
ты принял эстафету от тех, кто ходил этими тропами до тебя.

Прокоцин продолжает жить и меняться, и теперь ты — один из его голосов. 
Расскажи эту историю другим, вернись сюда в новом сезоне, или просто сохрани в памяти 
удивительное ощущение связи времен, которое дарит это место.

Спасибо, что прошел этот путь до конца!`,
    video: VIDEO,
};

export { normalize };
