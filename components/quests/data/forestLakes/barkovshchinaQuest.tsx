// data/forestLakes/barkovshchinaQuest.ts
import type { QuestStep, QuestFinale, QuestCity } from '@/components/quests/QuestWizard';
import { normalize, tryImage } from '@/components/quests/data/krakow/krakowDragon';

// картинки (можно заменить на реальные)
const IMG_START    = tryImage(() => require('@/assets/quests/barkovshchina/1.png'));
const IMG_POINT1   = tryImage(() => require('@/assets/quests/barkovshchina/1.png'));
const IMG_POINT2   = tryImage(() => require('@/assets/quests/barkovshchina/1.png'));
const IMG_POINT3   = tryImage(() => require('@/assets/quests/barkovshchina/1.png'));
const VIDEO = (() => { try { return require('@/assets/quests/barkovshchina/forest.mp4'); } catch { return null; } })();

export const BARKOV_CITY: QuestCity = {
    name: 'Тайны Барковщинского леса',
    lat: 55.101231,
    lng: 28.603838,
    countryCode: 'BY',
};

const createMapsUrl = (lat: number, lng: number): string => {
    return `https://maps.google.com/maps?q=${lat},${lng}`;
};

// Стартовая точка без задания
export const BARKOV_INTRO: QuestStep = {
    id: 'intro',
    title: 'Начало лесного приключения',
    location: 'Вход в заповедный лес',
    story: 'Добро пожаловать в таинственный лес Барковщины! Говорят, в этих местах обитают древние духи природы, которые оставили свои следы для тех, кто умеет видеть и слышать. Тебе предстоит пройти по трём загадочным точкам, выполнить задания лесных духов и раскрыть секреты этого волшебного места. Готовься к приключению!',
    task: 'Осмотрись вокруг, вдохни лесной воздух и нажми "Начать квест", когда будешь готов отправиться в путь.',
    answer: () => true,
    lat: 55.101231,
    lng: 28.603838,
    mapsUrl: createMapsUrl(55.101231, 28.603838),
    image: IMG_START,
};

// Основные точки с двумя заданиями каждая
export const BARKOV_STEPS: QuestStep[] = [
    {
        id: 'point-1',
        title: 'Родник Барковщина',
        location: 'Святой источник у деревни Барковщина',
        story: 'Этот источник называют сердцем Барковщинского леса. Легенда гласит, что когда-то здесь упал жезл старого мудреца. Из земли в том месте забил чистый ключ, который с тех пор никогда не пересыхает. Люди верят, что вода родника приносит здоровье и силы, а духи леса оберегают его от всякой беды.',
        task: 'Первое задание: посчитай, сколько источников выходит здесь на поверхность? (Введи число)',
        hint: 'Прислушайся к журчанию — не один голос слышен у воды.',
        answer: s => {
            const n = parseInt(s, 10);
            return Number.isInteger(n) && n === 4;
        },
        lat: 55.101231,
        lng: 28.603838,
        mapsUrl: createMapsUrl(55.101231, 28.603838),
        image: IMG_POINT1,
    },
    {
        id: 'point-1-2',
        title: 'Тайна родника',
        location: 'Тот же святой источник',
        story: 'Говорят, у родника часто можно увидеть камни, покрытые мхом. Это знак древних духов воды. Каждый сорт мха — как отдельная нота в мелодии леса.',
        task: 'Второе задание: найди камень со мхом и посчитай, сколько разных сортов мха на нём?',
        hint: 'Вглядись внимательнее: один камень может хранить в себе маленький зелёный лес из множества обитателей.',
        answer: s => {
            const n = parseInt(s, 10);
            return Number.isInteger(n) && n >= 1 && n <= 20;
        },
        lat: 55.101231,
        lng: 28.603838,
        mapsUrl: createMapsUrl(55.101231, 28.603838),
        image: IMG_POINT1,
    },
    {
        id: 'point-2',
        title: 'Шепчущие сосны',
        location: 'Роща вековых сосен',
        story: 'Ты попал в священную рощу, где деревья помнят каждую легенду этих мест. Их шелест - это не просто ветер, а настоящий язык природы. Прислушайся внимательно...',
        task: 'Первое задание: сколько разных птичьих голосов ты слышишь в этой роще? (Введи число)',
        hint: 'Закрой глаза на минуту и сосредоточься только на звуках. Не все голоса могут быть птицами!',
        answer: s => {
            const n = parseInt(s, 10);
            return Number.isInteger(n) && n >= 1 && n <= 6;
        },
        lat: 55.112393,
        lng: 28.603036,
        mapsUrl: createMapsUrl(55.112393, 28.603036),
        image: IMG_POINT2,
    },
    {
        id: 'point-2-2',
        title: 'Язык ветра',
        location: 'Все та же роща сосен',
        story: 'Ветер здесь играет особую мелодию. Он проходит через хвою и создает уникальную музыку леса. Может быть, ты сможешь понять, о чем поют эти деревья?',
        task: 'Второе задание: какое настроение у этого места? Опиши одним словом.',
        hint: 'Прислушайся к своим ощущениям. Спокойствие, таинственность, радость, грусть?',
        answer: s => normalize(s).length > 2,
        lat: 55.112393,
        lng: 28.603036,
        mapsUrl: createMapsUrl(55.112393, 28.603036),
        image: IMG_POINT2,
    },
    {
        id: 'point-3',
        title: 'Озеро отражений',
        location: 'Лесное озеро у тропы',
        story: 'Перед тобой открывается зеркальная гладь лесного озера. Говорят, его воды показывают не просто отражение, а истинную сущность смотрящего. Что ты увидишь в этой водной глади?',
        task: 'Первое задание: сколько уток плавает на озере?',
        hint: 'Внимательно посмотри на водную поверхность - утки могут прятаться в камышах!(Если уток нет, введи 0)',
        answer: s => normalize(s).length > 0,
        lat: 55.119597,
        lng: 28.605857,
        mapsUrl: createMapsUrl(55.119597, 28.605857),
        image: IMG_POINT3,
    },
    {
        id: 'point-3-2',
        title: 'Тайна водной глади',
        location: 'Все то же лесное озеро',
        story: 'Присмотрись к отражению в воде. Иногда озеро показывает не только тебя, но и скрытые послания духов леса. Может быть, в ряби воды или ее отблесках есть какой-то секрет?',
        task: 'Второе задание: опиши цвет воды в озере одним словом.',
        hint: 'Цвет может меняться в зависимости от погоды и времени дня. Будь внимателен!',
        answer: s => normalize(s).length > 2,
        lat: 55.119597,
        lng: 28.605857,
        mapsUrl: createMapsUrl(55.119597, 28.605857),
        image: IMG_POINT3,
    }
];

export const BARKOV_FINALE: QuestFinale = {
    text: 'Мы видели твой путь, путник. У родника ты услышал голоса воды, у сосен — шёпот ветра, у озера — отражение души. Ты был внимателен и честен, и потому лес открыл тебе свои тайны. Теперь мы знаем твоё имя и будем хранить твои шаги, куда бы ты ни направился. Возвращайся, когда сердце захочет — Барковщина всегда встретит тебя, как старого друга.',
    video: VIDEO,
};

export const BARKOV_TITLE = 'Хранитель тайн Барковщины';
export const BARKOV_STORAGE_KEY = 'quest_barkov_forest_secrets_v1';